# LeadsToB24

Система для автоматизации обработки данных из Google Таблицы, записи в SQLite и маршрутизации в зависимости от тегов.

## Назначение

Программа собирает данные из Google Таблицы, обрабатывает их, сохраняет в базу данных SQLite и маршрутизирует по клиентам в соответствии с тегами.

## Требования

- Python 3.8 или выше
- Pip для установки зависимостей
- Учетные данные сервисного аккаунта Google для доступа к API

## Установка

1. Клонировать репозиторий:

```bash
git clone [URL репозитория]
cd LeadsToB24
```

2. Установить зависимости:

```bash
pip install -r requirements.txt
```

3. Скопировать пример файла `.env` и настроить:

```bash
cp .env.example .env
```

4. Редактировать `.env` файл, указав необходимые параметры:

```bash
SOURCE_SPREADSHEET_ID=your_spreadsheet_id_here
SOURCE_SHEET_NAME=Февраль 2025
DB_PATH=database/leads.db
CHECK_INTERVAL=10
```

5. Поместить файл учетных данных сервисного аккаунта Google в директорию `credentials/` с именем `sheets-credentials.json`.

## Начальная настройка

1. Инициализировать базу данных:

```bash
python -m src.setup_db
```

2. Для добавления тестовых данных используйте флаг `--with-test-data`:

```bash
python -m src.setup_db --with-test-data
```

## Использование

### Запуск системы

Для запуска системы выполните:

```bash
python -m src.main
```

Система будет проверять новые записи в Google Таблице каждые 10 минут (или с интервалом, указанным в `.env` файле).

### Интерфейс командной строки

#### Добавление клиента

```bash
python -m src.cli add-client --name "Имя клиента" --tag "Тег для маршрутизации" --spreadsheet-id "ID таблицы" --sheet-name "Имя листа" --use-crm --webhook-url "URL вебхука"
```

#### Проверка статуса системы

```bash
python -m src.cli status
```

#### Ручной запуск обработки данных

```bash
python -m src.cli process
```

## Структура проекта

```
LeadsToB24/
├── src/
│   ├── main.py          # Главный входной скрипт
│   ├── setup.py         # Конфигурация и настройки
│   ├── sheets.py        # Модуль для работы с Google Sheets
│   ├── db.py            # Модуль для работы с SQLite
│   ├── processor.py     # Обработка данных и тегов
│   ├── router.py        # Маршрутизация данных
│   ├── client_config.py # Управление конфигурацией клиентов
│   ├── client_sheets.py # Отправка данных в таблицы клиентов
│   ├── webhook.py       # Отправка данных через вебхуки
│   ├── scheduler.py     # Планировщик задач
│   ├── setup_db.py      # Скрипт для настройки БД
│   └── cli.py           # Интерфейс командной строки
├── credentials/         # Директория для хранения credentials.json
├── database/            # Директория для БД
├── logs/                # Директория для логов
├── .env                 # Переменные окружения
├── .env.example         # Пример файла .env
├── requirements.txt     # Зависимости проекта
└── README.md            # Документация проекта
```
