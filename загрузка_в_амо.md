# Инструкция по работе с AmoCRM

## 1. Структура проекта
- `amo/` - основная директория с модулями AmoCRM
- `create_lead.py` - скрипт для создания отдельных лидов
- `upload_leads_to_amo.py` - скрипт для массовой загрузки лидов из Excel
- `.env` - файл с настройками подключения

## 2. Создание одиночного лида
Для создания одного лида используйте скрипт `create_lead.py`:

```bash
python create_lead.py
```

Процесс:
1. Скрипт запросит номер телефона
2. Автоматически создаст контакт с этим номером
3. Создаст лид и привяжет к нему контакт
4. Выведет ID созданного лида и контакта

## 3. Массовая загрузка лидов из Excel
Для загрузки множества лидов используйте скрипт `upload_leads_to_amo.py`:

```bash
python upload_leads_to_amo.py
```

Требования к Excel-файлу:
- Обязательно должна быть колонка "Телефон"
- Поддерживаются форматы .xlsx и .xls

Процесс:
1. Откроется окно выбора Excel-файла
2. После выбора файла скрипт покажет:
   - Общее количество найденных телефонов
   - Пример первых 3 телефонов
3. Запросит подтверждение на загрузку (y/n)
4. При подтверждении начнет загрузку:
   - Создает контакты и лиды последовательно
   - Показывает прогресс загрузки
   - Делает паузу 1 секунду между запросами
5. По окончании покажет статистику загрузки

## 4. Настройки в файле .env
Текущие настройки:
```
AMO_TOKEN=<ваш_токен>
AMO_BASE_DOMAIN=amocrm.ru
AMO_API_DOMAIN=jukov9999
AMO_ACCOUNT_ID=32363618
```

## 5. Константы для создания лидов (в create_lead.py)
```python
PHONE_FIELD_ID = 946599  # ID поля телефона для контакта
PIPELINE_ID = 9501726    # ID воронки
STATUS_ID = 75980382     # ID статуса "Первичный контакт"
RESPONSIBLE_USER_ID = 12390714  # ID ответственного (Evgenii)
```

## 6. Логирование
- Все логи сохраняются в директории `logs/`
- Основной лог: `logs/amo.log`
- Лог загрузки: `logs/upload_leads.log`

## 7. Кэширование
- Информация о полях и настройках AmoCRM кэшируется в директории `amo/cache/`
- При необходимости обновить кэш используйте:
```bash
python amo_get_fields.py refresh
```

## 8. Обработка ошибок
- Все ошибки записываются в лог-файлы
- При массовой загрузке, если лид не создался, скрипт продолжит работу со следующим
- В конце выводится статистика успешных/неуспешных загрузок

## 9. Безопасность
- Токен хранится в файле .env
- Используется долгосрочный токен, не требующий обновления
- Все запросы выполняются по HTTPS

Эта конфигурация уже работает, поэтому просто используйте скрипты как описано выше. Все необходимые настройки уже установлены и проверены.
